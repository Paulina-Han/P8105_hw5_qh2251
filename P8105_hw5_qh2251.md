Homework5
================
Paulina Han
2021/11/13

``` r
library(tidyverse)
```

    ## -- Attaching packages --------------------------------------- tidyverse 1.3.1 --

    ## v ggplot2 3.3.5     v purrr   0.3.4
    ## v tibble  3.1.5     v dplyr   1.0.7
    ## v tidyr   1.1.4     v stringr 1.4.0
    ## v readr   2.0.2     v forcats 0.5.1

    ## -- Conflicts ------------------------------------------ tidyverse_conflicts() --
    ## x dplyr::filter() masks stats::filter()
    ## x dplyr::lag()    masks stats::lag()

``` r
library(rvest)
```

    ## 
    ## 载入程辑包：'rvest'

    ## The following object is masked from 'package:readr':
    ## 
    ##     guess_encoding

``` r
library(httr)
```

``` r
knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)
theme_set(theme_minimal() + theme(legend.position = "bottom"))
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_color_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

# Problem 1

``` r
# read the data
url_1 = "https://raw.githubusercontent.com/washingtonpost/data-homicides/master/homicide-data.csv"

df = read_csv(url(url_1))
```

    ## Rows: 52179 Columns: 12

    ## -- Column specification --------------------------------------------------------
    ## Delimiter: ","
    ## chr (9): uid, victim_last, victim_first, victim_race, victim_age, victim_sex...
    ## dbl (3): reported_date, lat, lon

    ## 
    ## i Use `spec()` to retrieve the full column specification for this data.
    ## i Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
#create a city_state variable
df = 
  df %>% 
  mutate(
    city = as.factor(city),
    city_state = as.factor(paste(city, state, sep=",")))%>% 
  filter(city_state != "Tulsa_AL")

#create count of homicide
df = 
  df %>% 
  group_by(city) %>% 
  mutate(count = n()) 

#count unsolved cases
unsolved = df %>% 
  filter(disposition %in% c("Closed without arrest", "Open/No arrest")) %>% 
  group_by(city) %>% 
  summarize(unsolve_count = n()) %>% 
  distinct()

#join
df = left_join(df,unsolved,by ="city") 
```

This `df` data set is recording the data included the location of the
killing, whether an arrest was made and, in most cases, basic
demographic information about each victim. There are 52179 observations
in the datt set and 15 variables in the data set.

``` r
#creat a new data set
df_2 = df %>% 
  select(city_state,count,unsolve_count) %>% 
  distinct()
```

    ## Adding missing grouping variables: `city`

``` r
#prop.test ? how to estimate?
bal_prop = prop.test(df_2 %>% filter(city_state == "Baltimore,MD") %>%  pull(unsolve_count),
  df_2 %>% filter(city_state == "Baltimore,MD") %>%  pull(count))
bal_prop %>% broom::tidy()
```

    ## # A tibble: 1 x 8
    ##   estimate statistic  p.value parameter conf.low conf.high method    alternative
    ##      <dbl>     <dbl>    <dbl>     <int>    <dbl>     <dbl> <chr>     <chr>      
    ## 1    0.646      239. 6.46e-54         1    0.628     0.663 1-sample~ two.sided

``` r
#all cities
results_df = 
  df_2 %>% 
  mutate(
    prop_tests = map2(.x = unsolve_count, .y = count, ~prop.test(x = .x, n = .y)),
    tidy_tests = map(.x = prop_tests, ~broom::tidy(.x))
  ) %>% 
  select(-prop_tests) %>% 
  unnest(tidy_tests) %>% 
  select(city_state, estimate, conf.low, conf.high)#why always have city
```

    ## Adding missing grouping variables: `city`

``` r
#plot why cannot reorder: must ungroup first
results_df %>% 
  ungroup() %>% 
  mutate(city = fct_reorder(city_state, estimate)) %>% 
  ggplot(aes(x = city, y = estimate)) +
  geom_point() + 
  geom_errorbar(aes(ymin = conf.low, ymax = conf.high)) +
  labs(
    title = "prop.test of unsolve cases",
    x = "city",
    y = "unsolve cases",
    ) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
```

<img src="P8105_hw5_qh2251_files/figure-gfm/unnamed-chunk-4-1.png" width="90%" />

# Problem 2

``` r
list.files(path ="data/.")
```

    ##  [1] "con_01.csv" "con_02.csv" "con_03.csv" "con_04.csv" "con_05.csv"
    ##  [6] "con_06.csv" "con_07.csv" "con_08.csv" "con_09.csv" "con_10.csv"
    ## [11] "exp_01.csv" "exp_02.csv" "exp_03.csv" "exp_04.csv" "exp_05.csv"
    ## [16] "exp_06.csv" "exp_07.csv" "exp_08.csv" "exp_09.csv" "exp_10.csv"

``` r
dat_path = str_c("data/",list.files(path ="data/."))

lgt_df = 
  tibble(
  obs = list.files(path ="data/.")
) %>% 
  mutate(
    data = purrr::map(dat_path,read_csv)
  ) %>% 
  unnest(data) %>% 
  separate(obs,into = c("arm","id","file")) %>% 
  select(-file) %>% 
   pivot_longer(
    week_1:week_8,
    names_to = "week",
    names_prefix = "week_",
    values_to = "value"
  ) %>% 
  mutate(week = as.numeric(week))
  
#make a plot
lgt_df %>% 
 ggplot(aes(x = week, y = value, color =id))+
   facet_grid(. ~ arm)+
  geom_line()+
   labs(
    title = "comparison between groups",
    x = "week",
    y = "value",
    )
```

<img src="P8105_hw5_qh2251_files/figure-gfm/unnamed-chunk-5-1.png" width="90%" />

We can see from the plot that the value observed increased with time.
The experiment group tends to have higher value than the control group.

# Problem 3

``` r
set.seed(10)

iris_with_missing = iris %>% 
  map_df(~replace(.x, sample(1:150, 20), NA)) %>%
  mutate(Species = as.character(Species))

missing_replace = function(x) {
 
  if(is.numeric(x)){
   x =  replace_na(x,mean(x,na.rm = T ))
    }
  else if(is.character(x)){
    x =replace_na(x,"virginica")
  }
}



iris_with_replace=map(iris_with_missing, missing_replace)
```
